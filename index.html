<!DOCTYPE html>
<html>
    <head>
        <title>Page Title</title>
    </head>
    <body>
        <style id=styling>
            #login {

 margin: auto 5px;
    width: 95vw;
    height: 95vh;
  background:rgb(44,47,51);
  color:white;
 
}
#iframe {
  margin: auto -5px;
    width:90vw;
    height: 90vh;
    overflow-y:scroll;
border:solid 2px;
color: silver;
}
#message {
    bottom:10vh;
    position:absolute;
}

body {
background:rgb(44,47,51);
            }
            #pfp {
    border:round transparent;
    border-radius:50%;
    height:5vh;
    width:5vh;
}
#botmsg {
    border:round transparent;
    background:green;
    border-radius:20%;
    height:5vh;
    width:7vh;
    font-size:80%;
}
        </style>
        <div id=shown>
            <button onclick='theme()'>change theme</button>
        <div id=login><p>username:</p>
        <input type=text id=username>
        <p>password:</p>
        <input type=password id=password><button id=show onclick="show()">Show</button>
        <p id=note>Notice: dont use a password that you use for alot of stuff, i can see what you put in</p>
        <button onclick="login()">Login</button>
        <button onclick="signUp()">Sign Up</button>
        <input type=checkbox><span>Remember Me</span></div>
        </div>
        <div id=hidden>
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src='https://www.gstatic.com/firebasejs/3.4.0/firebase.js'></script>
    <script>
    console.log = function(input) {
        database.ref('console').set(input)
    }
          // Your web app's Firebase configuration
      eval(window.atob(`dmFyIGZpcmViYXNlQ29uZmlnID0gewogICAgICAgIGFwaUtleTogIkFJemFTeUJieExqdG1MMngxRDFWVjJtbjB4dzFqUVRQRUNTdnVXbyIsCiAgICAgICAgYXV0aERvbWFpbjogIm9ubGluZS1jaGF0LTE2ZmIwLmZpcmViYXNlYXBwLmNvbSIsCiAgICAgICAgZGF0YWJhc2VVUkw6ICdodHRwczovL29ubGluZS1jaGF0LTE2ZmIwLmZpcmViYXNlaW8uY29tLycsCiAgICAgICAgcHJvamVjdElkOiAib25saW5lLWNoYXQtMTZmYjAiLAogICAgICAgIHN0b3JhZ2VCdWNrZXQ6ICJvbmxpbmUtY2hhdC0xNmZiMC5hcHBzcG90LmNvbSIsCiAgICAgICAgbWVzc2FnaW5nU2VuZGVySWQ6ICI0MTY1ODQ1NzA5ODgiLAogICAgICAgIGFwcElkOiAiMTo0MTY1ODQ1NzA5ODg6d2ViOjYxOTU5NTVlZjRjNjVkMTk4NDYwNDkiLAogICAgICAgIG1lYXN1cmVtZW50SWQ6ICJHLVRLSFBLUkY3UzQiCiAgICAgIH07CiAgICAgIC8vIEluaXRpYWxpemUgRmlyZWJhc2UKICAgICAgICAvLyBmb3JjZSB3ZWIgc29ja2V0cyB0byBwcmV2ZW50IFhNTEh0dHBSZXF1ZXN0IHdhcm5pbmcKICAgICAgICBmaXJlYmFzZS5kYXRhYmFzZS5JTlRFUk5BTC5mb3JjZVdlYlNvY2tldHMoKTsKICAgICAgICAvLyBhY2Nlc3Mgb3VyIGRhdGFiYXNlCiAgICAgIGZpcmViYXNlLmluaXRpYWxpemVBcHAoZmlyZWJhc2VDb25maWcpOw==`))
      var database = firebase.database()
      database.ref("msgs").on("value", function (snapshot) {
        json.messages = snapshot.val()
        if(trueStart) hasStarted = true
        
      });
      database.ref("onlineUsers").on("value", function (snapshot) {
        json.online = snapshot.val()
      });
      database.ref("users").on("value", function (snapshot) {
        json.users = snapshot.val()
      });
      database.ref("payments").on("value", function (snapshot) {
        json.payed = snapshot.val()
      });
      var gotten = {
            users:'',
            msgs:''
      }
      var sending = false
      var logging = false
      var init = false
      var userNumber = 0
      var hasStarted = false
      var trueStart = false
var onlineUsers = 0
var lastCheck = 0
var checkTime = 0
var startup = true
var chatId = 'main'
var lastChatId
var oldJson = json
      setInterval(function() {
            if(hasStarted) {
                var y = document.querySelector("#iframe")   
y.innerHTML = ''
            if(json.messages === null) json.messages=[]; sending = true
    for(var x = 0;x<json.messages.length;x++) {
        if(userAdmin) {
        if(json.messages[x][1] != lastUser) {
   if(json.messages[x][3] != true) {
y.innerHTML += ("<p><img id=pfp src="+json.messages[x][4]+">"+json.messages[x][1]+" at "+json.messages[x][2]+" sent: </p> <p>"+json.messages[x][0]+" <span onclick='remove("+x+")'><i><b>X</b></i></span></p>")
} else {
    y.innerHTML += ("<p><img id=pfp src="+json.messages[x][4]+"><b>"+json.messages[x][1]+" at "+json.messages[x][2]+" sent:</b> </p> <b>"+json.messages[x][0]+"</b> <span onclick=\"remove("+x+")\"><i><b>X</b></i></span></p>")
}
    } else {
        if(json.messages[x][3] == true) {
        y.innerHTML += ("<p><b>"+json.messages[x][0]+"</b> <span onclick='remove("+x+")'><i><b>X</b></i></span></p>")
        
        } else {
        y.innerHTML += ('<p>'+json.messages[x][0]+" <span onclick='remove("+x+")'><i><b>X</b></i></span></p>")
        }
    }
    } else if(json.messages[x][1] != user) {
        if(json.messages[x][1] != lastUser) {
   if(json.messages[x][3] != true) {
y.innerHTML += ("<p><img id=pfp src="+json.messages[x][4]+">"+json.messages[x][1]+" at "+json.messages[x][2]+" sent: </p> <p>"+json.messages[x][0]+"</p>")
} else {
    y.innerHTML += ("<p><img id=pfp src="+json.messages[x][4]+"><b>"+json.messages[x][1]+" at "+json.messages[x][2]+" sent:</b> </p> <p><b>"+json.messages[x][0]+"</b></p>")
}
    } else {
        if(json.messages[x][3] == true) {
        y.innerHTML += ("<p><b>"+json.messages[x][0]+'</b></p>')
        } else {
        y.innerHTML += ("<p>"+json.messages[x][0]+'</p>')
        }
    }
    } else {
        if(json.messages[x][1] != lastUser) {
   if(json.messages[x][3] != true) {
y.innerHTML += ("<p><img id=pfp src="+json.messages[x][4]+">"+json.messages[x][1]+" at "+json.messages[x][2]+" sent: </p> <p>"+json.messages[x][0]+" <span onclick='remove("+x+")'><i><b>X</b></i></span></p>")
} else {
    y.innerHTML += ("<p><img id=pfp src="+json.messages[x][4]+"><b>"+json.messages[x][1]+" at "+json.messages[x][2]+" sent:</b> </p> <b>"+json.messages[x][0]+"</b> <span onclick=\"remove("+x+")\"><i><b>X</b></i></span></p>")
}
    } else {
        if(json.messages[x][3] == true) {
        y.innerHTML += ("<p><b>"+json.messages[x][0]+"</b> <span onclick='remove("+x+")'><i><b>X</b></i></span></p>")
        
        } else {
        y.innerHTML += ('<p>'+json.messages[x][0]+" <span onclick='remove("+x+")'><i><b>X</b></i></span></p>")
        }
    }
    }
    lastUser = json.messages[x][1]
    }
    if(begin) {
        var thiss = document.getElementById('iframe')
        thiss.scrollTo(0,thiss.scrollHeight)
        begin = false
    }
    hasStarted = false
    }
          if(sending || init) {
            sending = false
           database.ref('msgs').set(json.messages)
          }
          if(logging || init) {
              database.ref('users').set(json.users)
              if(init) console.log('initiation complete')
              logging = init = false
          }

      },1)
var json = {}
var no = true
var user
var userAdmin 
var isMobile = false; 
if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp}|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))) { 
isMobile = true; 
}
if(!isMobile) {
if(localStorage.getItem('user') !== '') {
user = localStorage.getItem('user')
} else {
user = ''
}
if(localStorage.getItem('admin') !== '') {
userAdmin = localStorage.getItem('admin')
} else {
userAdmin = false
}
} else {
    userAdmin = false
    user = ''
}
var userProfile = ''
var userArr = []
var showing = false
var checked = false
var html = "<input type=text> <button onclick='send()'>Send</button><button><a href='https://code.sololearn.com/WiM90U3TJ3T0/#html'>New Update Log</a></button><button onclick='pfp()'>set profile picture</button><button onclick='theme()'>change theme</button><br> <div id=iframe></div>"
function intervaled() {
trueStart = true
}
var begin = false
var lastUser = ''
setTimeout(function() {
    document.querySelector("input[type=checkbox]").onclick = function() {
        if(checked) {
            checked = false
        } else {
            checked = true
        }
    }
},1)
function show() {
    if(!showing) {
        document.getElementById('password').setAttribute('type','text')
        document.getElementById('show').innerHTML = 'Hide'
        showing = true
    } else {
        document.getElementById('password').setAttribute('type','password')
        document.getElementById('show').innerHTML = 'Show'
        showing = false
    }
}
function signUp() {
var wantedName = document.getElementById("username").value
var password = document.getElementById("password").value
if(password.length <1) {
    return
}
if(wantedName.length <1) {
    return
}

for(var x = 0; x<json.users.length; x++) {
    if(json.users[x][0] == wantedName) {
        return
    }
    }
    user = wantedName
    var code = ''
    for(var z = 0;z<10;z++) {
        code += Math.floor(Math.random()*10)
    }
    json.users.push([user,password,false,'',code])
    userArr = json.users[json.users.length-1]
    json.messages.push([user+' logged in!','','',false,''])
    logging=true
        document.getElementById('shown').innerHTML = html
        document.querySelector('input').addEventListener('keypress',function(e) {if(e.keyCode == 13){send()} })
        setInterval(intervaled,1)
        hasStarted = true
        alert('your code is: '+code)
if(!isMobile) {
if(checked) {
    localStorage.setItem('user',user)
    localStorage.setItem('pass',password)
    localStorage.setItem('admin',false)
} else {
    localStorage.clear()
}
}
}
function login() {
var wantedName = document.getElementById("username").value
var password = document.getElementById("password").value
if(password.length <1) {
    return
}
if(wantedName.length <1) {
    return
}
for(var x = 0; x<json.users.length; x++) {
    if((json.users[x][0] == wantedName&&json.users[x][1] == password)) {
        
        user = wantedName
        userAdmin = json.users[x][2]
        userProfile = json.users[x][3]
        userArr = json.users[x]
        json.messages.push([user+' logged in!','Console','',userAdmin,''])
        document.getElementById('shown').innerHTML = html
        document.querySelector('input').addEventListener('keypress',function(e) {
            if(e.keyCode == 13){
                send()
            } 
        })
        begin = true
        setInterval(intervaled,1)
        hasStarted = true
if(!isMobile) {
if(checked) {
    localStorage.setItem('user',user)
    localStorage.setItem('pass',password)
    localStorage.setItem('admin',userAdmin)
} else {
    localStorage.clear()
}
}
        return
    }
}
}
function startlogin() {
if(!isMobile) {
document.getElementById('username').value = user
document.getElementById('password').value = localStorage.getItem('pass')
}
}
setTimeout(startlogin,1)
function sender(args) {
    document.querySelector('input').value = args
    send()
}
function command(prefix,input) {
    if(input.startsWith(prefix)) {
    var args = input.slice(prefix.length).split(' ')
    var cmd = args.shift()
    if(userAdmin) {
        if(cmd == 'true') return input.slice(cmd.length+1)
    }
    }
       return input.replace(/</gi,'&lt;').replace(/>/gi,'&gt;').replace(/&/gi,'&â€Ž')
    
}
function link(input) {
    console.log('clicked')
    document.querySelectorAll('input')[1].value = input
}
function remove(input) {
    json.messages.splice(input,1)
    sending = true
}
function send() {

var time = new Date()
var sentTime = time.getMonth()+1+"/"+time.getDate()+"/"+time.getFullYear()+" "+time.getHours()+":"+time.getMinutes()
    var message = document.querySelector('input').value
    document.querySelector('input').value = ""
   if(message.length >= 1) {
    json.messages.push([command('.',message),user,sentTime,userAdmin,userProfile,false])
   }
   sending = true
}
function pfp() {
    var save = prompt('enter source link for profile image')
    json.users[json.users.indexOf(userArr)][3] = save
    userArr[3] = save
    userProfile = save
    logging = true
}
var currentTheme = true
function theme() {
    if(!currentTheme) {
        document.getElementById('styling').innerHTML = `
        #login {

 margin: auto 5px;
    width: 95vw;
    height: 95vh;
  background:rgb(44,47,51);
  color:white;
 
}
#iframe {
  margin: auto -5px;
    width:90vw;
    height: 90vh;
    overflow-y:scroll;
border:solid 2px;
color: silver;
}
#message {
    bottom:10vh;
    position:absolute;
}

body {
background:rgb(44,47,51);
}
#pfp {
    border:round transparent;
    border-radius:50%;
    height:5vh;
    width:5vh;
}
#botmsg {
    border:round transparent;
    background:green;
    border-radius:5%;
    height:5vh;
    width:7vh;
        font-size:90%;
}
        `
        currentTheme = true
    } else {
        document.getElementById('styling').innerHTML = `
        #login {

 margin: auto 5px;
    width: 95vw;
    height: 95vh;
 
}
#iframe {
  margin: auto -5px;
    width:90vw;
    height: 90vh;
    overflow-y:scroll;
    border:solid 2px
}
#message {
    bottom:10vh;
    position:absolute;
}
#pfp {
    border:round transparent;
    border-radius:50%;
    height:5vh;
    width:5vh;
}
#botmsg {
    border:round transparent;
    background:green;
    border-radius:5%;
    height:5vh;
    width:7vh;
        font-size:90%;
}
        `
        currentTheme = false
    }
}
        </script>
        </div>
    </body>
</html> 
